// scripts/create-netlify-config.js
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

// Recreate __dirname for ES module scope, as it's not available by default.
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const tomlContent = `# Netlify configuration for timeouts and background functions

# This file is auto-generated by scripts/create-netlify-config.js during the build process.

[functions]
  # Tell Netlify where to find the compiled serverless functions.
  directory = "functions-dist"
  # Set the default timeout for all synchronous serverless functions to 25 seconds.
  timeout = 25

# Define 'process-analysis-job' as a background function.
# This allows it to run for up to 15 minutes, which is essential for the
# asynchronous, long-running tasks in the AI Strategy Hub, preventing 502 errors.
[functions."process-analysis-job"]
  background = true
`;

// The script is in /scripts, so we go up one level to the project root.
const filePath = path.join(__dirname, '..', 'netlify.toml');

try {
  fs.writeFileSync(filePath, tomlContent.trim());
  console.log('Successfully created clean netlify.toml file.');
} catch (error) {
  console.error('Failed to create netlify.toml file:', error);
  process.exit(1); // Exit with a failure code to stop the build
}
